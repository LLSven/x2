# 此文件
对编程进行总结，提炼出几个用于调试和编写代码的原则

# 原则
1.单源性
如果一个常数反复用到，将其定义为一个符号
2.内存假设
在进行某个内存操作前，内存应当的内容
操作后，应当的内容
3.解释匿名操作
对于普通的赋值，由于它们不是具名函数，所以含义不那么明显。对于这种赋值，必须说明意义。
4.限制修改
不要在做了大量修改之后再调试
应当边修改边调试，保证正确性

# 语言、工具和编程
绝对不要依赖任何g++的-O选项，因为任何一个编程上的错误都会引起难以察觉的微妙错误

gcc的优化有以下几个不可靠的地方：
1.会移动代码块的位置
2.不会压缩代码空间
3.如果放置汇编代码，就会产生非常诡异的优化结果

# 设计原则
1.对于文件系统及类似的其他组件，不能依赖于任何系统，它的长度必须具有固定的长度，在任何架构下都相同
2.一个类尽量不直接使用编译器提供的类型、平台上的类型直接，而是通过模板参数来使用这些类型。这样可做到跨平台和无异议。
3.考虑如果需要修改，改动尽量少
4.必须测试高端内存地址，如32位必须测试0xfffffff0 + 0xff,只能失败
5.除非希望一个使用一个带模板参数的类型作为模板来分配多个类型，否则应当使用无模板参数的模板。即避免使用template <class> class
6.避免任何二义性。检查二义性，检查其是否混淆了同一平台多个环境，多个平台的同一类型。不要使用size_t作为存储类型。
7.位操作仅仅应用于无符号类型。
8.尽量使用const
9.弃用c可变参数列表
10.基类析构函数必须显示写出且为virtual（但是如果仅仅该函数为virtual则为了避免空间浪费可以取消该规则）
11.析构函数尽量不抛出异常，如果有异常，在其内部处理。
12.简单类型(基本内置类型)使用操作符，其他任何类结构都不要使用操作符，使用函数来替代。（不要重载任何操作符）
13.函数文档注释
14.对任何可能返回NULL的值都不能放过，有时候加一条语句能够节省后面大量的时间。（至今一个返回0的函数仍然让我印象深刻）
15.重构是如此平常、重要而麻烦的事情，任何有利于重构的设计都是值得的，包括影响程序可读性
16.用于不要将非主程序放到main.cpp文件中，形成单独的库
17.如果一个稍微强一点的假设能够大幅降低复杂性，则使用这个假设
18.用例分析在写程序之前进行
19.在C++中，所有的goto error都有替代性选择；请不要使用goto error.
20.永远不要手动管理内存，因为你不知道错误发生时要怎么处理有已经分配的资源。感谢C++的析构函数，你可以定义一个资源管理类来帮你做这件事。
21.return加括号
22.不要使用errno作为变量名，这是个占用的名称
23.模板命名标准：模板上声明的符号可以看成和class定义的符号处在同一个级别。以下面的例子为例
```c++
template <class __T>
class Foo:public Bar<String,__T>{
public:
    using This = Foo<__T>;
    using Super = Bar<int,__T>;
    using __Foo = This;
    using __Bar = Super;
    using __String = typename Super::__String; //从父类继承，也可以不写

}
```
为例，This Super为定义指向类本身以及类的唯一父类,所有加上两个下划线的名称，都被视为局部名称，也就是仅在类的作用域内起作用（即使他们在全局定义，也在此处被覆盖）
24.可重构的标准1： 避免直接使用模板，使用内部的名称来代替模板
在声明和实现分离的设计中，为了避免template改变带来的麻烦，其一必须保证所有的template声明, class::作用域能够使用简单的查找/替换功能修改，其二可选的是，通过宏定义__DEF_Template_Foo, __DEF_Foo来替换上述两个名称，从而避免修改扩散。为了不产生额外影响，在定义结束后使用#undef取消原来的定义。
```c++
#define __DEF_X2fsUtil_Template template <class __EnvInterface,typename __SizeType,int __Alignment>
#define __DEF_X2fsUtil X2fsUtil<__EnvInterface,__SizeType,__Alignment>

/*...*/
__DEF_X2fsUtil_Template
typename __DEF_X2fsUtil::FileTree* __DEF_X2fsUtil::getFileTree()
{
    return &fileTree;
}
#undef __DEF_X2fsUtil_Template
#undef __DEF_X2fsUtil
```
25.测试能较早地发现问题，能够驱动设计更快迭代
26.代码风格：启用-Wall -Werror -Werror=old-style-cast,-Werror=effctc++
使用nullptr代替所有的NULL常量
26.永远不要在局部作用域中使用include.除非你知道你是对的。
# 建议
本节给出开发程序的各个方面的建议，包括考虑程序员自身的因素。

1.绝对遵循习惯，按照时间进行工作
2.按照既定目标进行工作
3.写下开发log（向上增长）
4.不允许长时间工作。当我们处于工作状态时，大脑总是处于消耗状态，想问题也变得艰难。一个小小的休息就能重新进入状态
5.不要熬夜，防止猝死
6.使用表格准则法：pre, in/log,post  3个部分进行备注。
7.如果感到疲惫，就应该停止。

# 书籍